<div class="page page-center">
  <div class="container container-tight py-4">
    <div class="text-center mb-4">
      <a href="." class="navbar-brand navbar-brand-autodark">
        <img src="logo.png" width="110" height="32" alt="OnAl Yazılım" class="navbar-brand-image">
      </a>
    </div>

    @if (!emailSent()) {
      <!-- Password Reset Request Form -->
      <div class="card card-md">
        <div class="card-body">
          <h2 class="h2 text-center mb-4">Şifremi Unuttum</h2>
          <p class="text-muted text-center mb-4">
            E-posta adresinizi girin ve şifre sıfırlama bağlantısını size gönderelim.
          </p>

          <form [formGroup]="forgotPasswordForm" (ngSubmit)="onSubmit()" novalidate>
            <!-- Email Field -->
            <div class="mb-3">
              <label class="form-label">E-posta Adresi</label>
              <div class="input-group input-group-flat">
                <span class="input-group-text">
                  <lucide-angular [img]="Mail" class="icon"></lucide-angular>
                </span>
                <input
                  type="email"
                  class="form-control"
                  [class.is-invalid]="isFieldInvalid('email')"
                  formControlName="email"
                  placeholder="E-posta adresinizi girin"
                  autocomplete="email">
              </div>
              @if (isFieldInvalid('email')) {
                <div class="invalid-feedback">
                  @if (forgotPasswordForm.get('email')?.errors?.['required']) {
                    E-posta adresi gereklidir
                  }
                  @if (forgotPasswordForm.get('email')?.errors?.['email']) {
                    Geçerli bir e-posta adresi girin
                  }
                </div>
              }
            </div>

            <!-- Submit Button -->
            <div class="form-footer">
              <button
                type="submit"
                class="btn btn-primary w-100"
                [disabled]="forgotPasswordForm.invalid || isLoading()">
                @if (isLoading()) {
                  <div class="spinner-border spinner-border-sm me-2" role="status"></div>
                  Gönderiliyor...
                } @else {
                  <lucide-angular [img]="Send" class="icon me-1"></lucide-angular>
                  Şifre Sıfırlama Bağlantısı Gönder
                }
              </button>
            </div>
          </form>
        </div>
      </div>
    } @else {
      <!-- Success Message -->
      <div class="card card-md">
        <div class="card-body text-center">
          <div class="text-success mb-3">
            <lucide-angular [img]="CheckCircle" class="icon icon-lg"></lucide-angular>
          </div>
          <h2 class="h2 text-success mb-4">E-posta Gönderildi!</h2>
          <p class="text-muted mb-4">
            <strong>{{ sentEmail() }}</strong> adresine şifre sıfırlama bağlantısı gönderildi.
            Lütfen e-posta kutunuzu kontrol edin.
          </p>

          <!-- Resend Button -->
          <div class="mb-3">
            <button
              type="button"
              class="btn btn-outline-primary"
              (click)="resendEmail()"
              [disabled]="resendCooldown() > 0 || isLoading()">
              @if (isLoading()) {
                <div class="spinner-border spinner-border-sm me-2" role="status"></div>
                Gönderiliyor...
              } @else {
                <lucide-angular [img]="Send" class="icon me-1"></lucide-angular>
                @if (resendCooldown() > 0) {
                  Tekrar Gönder ({{ resendCooldown() }}s)
                } @else {
                  Tekrar Gönder
                }
              }
            </button>
          </div>

          <!-- Help Text -->
          <div class="text-muted small">
            <p class="mb-2">E-posta gelmedi mi?</p>
            <ul class="list-unstyled text-start">
              <li>• Spam/çöp kutunuzu kontrol edin</li>
              <li>• E-posta adresinizi doğru yazdığınızdan emin olun</li>
              <li>• Birkaç dakika bekleyin, bazen gecikmeli gelebilir</li>
            </ul>
          </div>
        </div>
      </div>
    }

    <!-- Back to Login -->
    <div class="text-center mt-3">
      <a routerLink="/auth/login" class="text-decoration-none">
        <lucide-angular [img]="ArrowLeft" class="icon me-1"></lucide-angular>
        Giriş sayfasına dön
      </a>
    </div>
  </div>
</div>