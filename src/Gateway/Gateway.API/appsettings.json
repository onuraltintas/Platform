{
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft.AspNetCore": "Warning",
      "Yarp": "Information"
    }
  },
  "AllowedHosts": "*",
  "ReverseProxy": {
    "Routes": {
      "auth-route": {
        "ClusterId": "identity-cluster",
        "Match": {
          "Path": "/api/v1/auth/{**catch-all}"
        },
        "Transforms": [
          {
            "PathPattern": "/api/v1/auth/{**catch-all}"
          },
          {
            "RequestHeader": "X-Gateway-Source",
            "Set": "API-Gateway"
          },
          {
            "RequestHeader": "X-Request-Id",
            "Set": "{RequestId}"
          }
        ],
        "Metadata": {
          "RequireAuth": "false",
          "RateLimit": "100"
        }
      },
      "account-route": {
        "ClusterId": "identity-cluster",
        "Match": {
          "Path": "/api/v1/account/{**catch-all}"
        },
        "Transforms": [
          {
            "PathPattern": "/api/v1/account/{**catch-all}"
          },
          {
            "RequestHeader": "X-Gateway-Source",
            "Set": "API-Gateway"
          },
          {
            "RequestHeader": "X-Request-Id",
            "Set": "{RequestId}"
          }
        ],
        "Metadata": {
          "RequireAuth": "false",
          "RateLimit": "100"
        }
      },
      "users-route": {
        "ClusterId": "identity-cluster",
        "Match": {
          "Path": "/api/v1/users/{**catch-all}"
        },
        "Transforms": [
          { "PathPattern": "/api/v1/users/{**catch-all}" },
          { "RequestHeader": "X-Gateway-Source", "Set": "API-Gateway" },
          { "RequestHeader": "X-Request-Id", "Set": "{RequestId}" }
        ],
        "Metadata": { "RequireAuth": "true", "RateLimit": "100" }
      },
      "roles-route": {
        "ClusterId": "identity-cluster",
        "Match": { "Path": "/api/v1/roles/{**catch-all}" },
        "Transforms": [
          { "PathPattern": "/api/v1/roles/{**catch-all}" },
          { "RequestHeader": "X-Gateway-Source", "Set": "API-Gateway" },
          { "RequestHeader": "X-Request-Id", "Set": "{RequestId}" }
        ],
        "Metadata": { "RequireAuth": "true", "RateLimit": "100" }
      },
      
      "permissions-route": {
        "ClusterId": "identity-cluster",
        "Match": { "Path": "/api/v1/permissions/{**catch-all}" },
        "Transforms": [
          { "PathPattern": "/api/v1/permissions/{**catch-all}" },
          { "RequestHeader": "X-Gateway-Source", "Set": "API-Gateway" },
          { "RequestHeader": "X-Request-Id", "Set": "{RequestId}" }
        ],
        "Metadata": { "RequireAuth": "true", "RateLimit": "100" }
      },

      "roles-stats-route": {
        "ClusterId": "identity-cluster",
        "Match": { "Path": "/api/v1/roles/stats" },
        "Transforms": [
          { "PathPattern": "/api/v1/roles/stats" },
          { "RequestHeader": "X-Gateway-Source", "Set": "API-Gateway" },
          { "RequestHeader": "X-Request-Id", "Set": "{RequestId}" }
        ],
        "Metadata": { "RequireAuth": "true", "RateLimit": "30" }
      },

      "roles-clone-route": {
        "ClusterId": "identity-cluster",
        "Match": { "Path": "/api/v1/roles/{roleId}/clone" },
        "Transforms": [
          { "PathPattern": "/api/v1/roles/{roleId}/clone" },
          { "RequestHeader": "X-Gateway-Source", "Set": "API-Gateway" },
          { "RequestHeader": "X-Request-Id", "Set": "{RequestId}" }
        ],
        "Metadata": { "RequireAuth": "true", "RateLimit": "10" }
      },

      "roles-compare-route": {
        "ClusterId": "identity-cluster",
        "Match": { "Path": "/api/v1/roles/compare/{roleId1}/{roleId2}" },
        "Transforms": [
          { "PathPattern": "/api/v1/roles/compare/{roleId1}/{roleId2}" },
          { "RequestHeader": "X-Gateway-Source", "Set": "API-Gateway" },
          { "RequestHeader": "X-Request-Id", "Set": "{RequestId}" }
        ],
        "Metadata": { "RequireAuth": "true", "RateLimit": "20" }
      },

      "permissions-matrix-route": {
        "ClusterId": "identity-cluster",
        "Match": { "Path": "/api/v1/permissions/matrix" },
        "Transforms": [
          { "PathPattern": "/api/v1/permissions/matrix" },
          { "RequestHeader": "X-Gateway-Source", "Set": "API-Gateway" },
          { "RequestHeader": "X-Request-Id", "Set": "{RequestId}" }
        ],
        "Metadata": { "RequireAuth": "true", "RateLimit": "20" }
      },

      "permissions-by-service-route": {
        "ClusterId": "identity-cluster",
        "Match": { "Path": "/api/v1/permissions/by-service" },
        "Transforms": [
          { "PathPattern": "/api/v1/permissions/by-service" },
          { "RequestHeader": "X-Gateway-Source", "Set": "API-Gateway" },
          { "RequestHeader": "X-Request-Id", "Set": "{RequestId}" }
        ],
        "Metadata": { "RequireAuth": "true", "RateLimit": "50" }
      },

      "permissions-by-resource-route": {
        "ClusterId": "identity-cluster",
        "Match": { "Path": "/api/v1/permissions/by-resource" },
        "Transforms": [
          { "PathPattern": "/api/v1/permissions/by-resource" },
          { "RequestHeader": "X-Gateway-Source", "Set": "API-Gateway" },
          { "RequestHeader": "X-Request-Id", "Set": "{RequestId}" }
        ],
        "Metadata": { "RequireAuth": "true", "RateLimit": "50" }
      },

      "permission-discovery-route": {
        "ClusterId": "identity-cluster",
        "Match": { "Path": "/api/v1/permission-discovery/{**catch-all}" },
        "Transforms": [
          { "PathPattern": "/api/v1/permission-discovery/{**catch-all}" },
          { "RequestHeader": "X-Gateway-Source", "Set": "API-Gateway" },
          { "RequestHeader": "X-Request-Id", "Set": "{RequestId}" }
        ],
        "Metadata": { "RequireAuth": "true", "RateLimit": "50" }
      },

      "groups-route": {
        "ClusterId": "identity-cluster",
        "Match": { "Path": "/api/v1/groups/{**catch-all}" },
        "Transforms": [
          { "PathPattern": "/api/v1/groups/{**catch-all}" },
          { "RequestHeader": "X-Gateway-Source", "Set": "API-Gateway" },
          { "RequestHeader": "X-Request-Id", "Set": "{RequestId}" }
        ],
        "Metadata": { "RequireAuth": "true", "RateLimit": "100" }
      },
      
      
      "user-profile-route": {
        "ClusterId": "user-cluster",
        "Match": {
          "Path": "/api/v1/user-profiles/{**catch-all}"
        },
        "Transforms": [
          {
            "PathPattern": "/api/v1/user-profiles/{**catch-all}"
          },
          {
            "RequestHeader": "X-Gateway-Source",
            "Set": "API-Gateway"
          }
        ],
        "Metadata": {
          "RequireAuth": "true",
          "RateLimit": "50"
        }
      },
      "user-preferences-route": {
        "ClusterId": "user-cluster",
        "Match": {
          "Path": "/api/v1/user-preferences/{**catch-all}"
        },
        "Transforms": [
          {
            "PathPattern": "/api/v1/user-preferences/{**catch-all}"
          },
          {
            "RequestHeader": "X-Gateway-Source",
            "Set": "API-Gateway"
          }
        ],
        "Metadata": {
          "RequireAuth": "true",
          "RateLimit": "50"
        }
      },
      "user-gdpr-route": {
        "ClusterId": "user-cluster",
        "Match": {
          "Path": "/api/v1/gdpr/{**catch-all}"
        },
        "Transforms": [
          {
            "PathPattern": "/api/v1/gdpr/{**catch-all}"
          },
          {
            "RequestHeader": "X-Gateway-Source",
            "Set": "API-Gateway"
          }
        ],
        "Metadata": {
          "RequireAuth": "true",
          "RateLimit": "10"
        }
      },
      "user-email-route": {
        "ClusterId": "user-cluster",
        "Match": {
          "Path": "/api/v1/email-verification/{**catch-all}"
        },
        "Transforms": [
          {
            "PathPattern": "/api/v1/email-verification/{**catch-all}"
          },
          {
            "RequestHeader": "X-Gateway-Source",
            "Set": "API-Gateway"
          }
        ],
        "Metadata": {
          "RequireAuth": "false",
          "RateLimit": "20"
        }
      },
      "speedreading-profile-route": {
        "ClusterId": "speedreading-cluster",
        "Match": {
          "Path": "/api/v1/user-reading-profiles/{**catch-all}"
        },
        "Transforms": [
          {
            "PathPattern": "/api/v1/user-reading-profiles/{**catch-all}"
          },
          {
            "RequestHeader": "X-Gateway-Source",
            "Set": "API-Gateway"
          },
          {
            "RequestHeader": "X-Request-Id",
            "Set": "{RequestId}"
          }
        ],
        "Metadata": {
          "RequireAuth": "true",
          "RateLimit": "100"
        }
      },
      "speedreading-exercise-route": {
        "ClusterId": "speedreading-cluster",
        "Match": {
          "Path": "/api/v1/exercises/{**catch-all}"
        },
        "Transforms": [
          {
            "PathPattern": "/api/v1/exercises/{**catch-all}"
          },
          {
            "RequestHeader": "X-Gateway-Source",
            "Set": "API-Gateway"
          },
          {
            "RequestHeader": "X-Request-Id",
            "Set": "{RequestId}"
          }
        ],
        "Metadata": {
          "RequireAuth": "true",
          "RateLimit": "100"
        }
      },
      "speedreading-text-route": {
        "ClusterId": "speedreading-cluster",
        "Match": {
          "Path": "/api/v1/reading-texts/{**catch-all}"
        },
        "Transforms": [
          {
            "PathPattern": "/api/v1/reading-texts/{**catch-all}"
          },
          {
            "RequestHeader": "X-Gateway-Source",
            "Set": "API-Gateway"
          },
          {
            "RequestHeader": "X-Request-Id",
            "Set": "{RequestId}"
          }
        ],
        "Metadata": {
          "RequireAuth": "true",
          "RateLimit": "100"
        }
      },
      "speedreading-analytics-route": {
        "ClusterId": "speedreading-cluster",
        "Match": {
          "Path": "/api/v1/speedreading/analytics/{**catch-all}"
        },
        "Transforms": [
          {
            "PathPattern": "/api/v1/analytics/{**catch-all}"
          },
          {
            "RequestHeader": "X-Gateway-Source",
            "Set": "API-Gateway"
          },
          {
            "RequestHeader": "X-Request-Id",
            "Set": "{RequestId}"
          }
        ],
        "Metadata": {
          "RequireAuth": "true",
          "RateLimit": "100"
        }
      },
      "notification-route": {
        "ClusterId": "notification-cluster",
        "Match": {
          "Path": "/api/notifications/{**catch-all}"
        },
        "Transforms": [
          {
            "PathPattern": "/api/{**catch-all}"
          },
          {
            "RequestHeader": "X-Gateway-Source",
            "Set": "API-Gateway"
          }
        ],
        "Metadata": {
          "RequireAuth": "true",
          "RateLimit": "200"
        }
      }
    },
    "Clusters": {
      "identity-cluster": {
        "LoadBalancingPolicy": "RoundRobin",
        "HealthCheck": {
          "Active": {
            "Enabled": true,
            "Interval": "00:00:30",
            "Timeout": "00:00:05",
            "Policy": "ConsecutiveFailures",
            "Path": "/health"
          },
          "Passive": {
            "Enabled": true,
            "Policy": "TransportFailureRate",
            "ReactivationPeriod": "00:02:00"
          }
        },
        "Destinations": {
          "identity-primary": {
            "Address": "http://identity/"
          }
        },
        "Metadata": {
          "CircuitBreakerEnabled": "true",
          "CircuitBreakerFailureThreshold": "5",
          "CircuitBreakerTimeoutSeconds": "30"
        }
      },
      "user-cluster": {
        "LoadBalancingPolicy": "LeastRequests",
        "HealthCheck": {
          "Active": {
            "Enabled": true,
            "Interval": "00:00:30",
            "Timeout": "00:00:05",
            "Policy": "ConsecutiveFailures",
            "Path": "/health"
          }
        },
        "Destinations": {
          "user-primary": {
            "Address": "http://user/",
            "Health": "http://user/health"
          }
        }
      },
      "speedreading-cluster": {
        "LoadBalancingPolicy": "RoundRobin",
        "HealthCheck": {
          "Active": {
            "Enabled": true,
            "Interval": "00:00:30",
            "Timeout": "00:00:05",
            "Policy": "ConsecutiveFailures",
            "Path": "/health"
          },
          "Passive": {
            "Enabled": true,
            "Policy": "TransportFailureRate",
            "ReactivationPeriod": "00:02:00"
          }
        },
        "Destinations": {
          "speedreading-primary": {
            "Address": "http://speedreading/",
            "Health": "http://speedreading/health"
          }
        }
      },
      "notification-cluster": {
        "LoadBalancingPolicy": "PowerOfTwoChoices",
        "HealthCheck": {
          "Active": {
            "Enabled": true,
            "Interval": "00:00:30",
            "Timeout": "00:00:05",
            "Policy": "ConsecutiveFailures",
            "Path": "/health"
          }
        },
        "Destinations": {
          "notification-primary": {
            "Address": "http://localhost:5030/",
            "Health": "http://localhost:5030/health"
          }
        }
      }
    }
  },
  "Gateway": {
    "Environment": "Development",
    "Port": 5000,
    "EnableSwagger": true,
    "EnableRequestLogging": true,
    "EnableResponseLogging": true,
    "EnableHealthChecks": true,
    "EnableMetrics": true,
    "Security": {
      "RequireHttps": false,
      "EnableApiKeyAuthentication": false,
      "TokenExpirationMinutes": 60,
      "MaxRequestSizeBytes": 10485760
    },
    "RateLimiting": {
      "Enabled": true,
      "RequestsPerMinute": 100,
      "RequestsPerHour": 1000,
      "RequestsPerDay": 10000,
      "EnablePerUserLimits": true,
      "AuthenticatedUserRequestsPerMinute": 200,
      "EndpointLimits": []
    },
    "Cors": {
      "Enabled": true,
      "AllowedOrigins": ["http://localhost:4200", "https://localhost:3000"],
      "AllowedMethods": ["GET", "POST", "PUT", "DELETE", "PATCH", "OPTIONS"],
      "AllowedHeaders": ["*"],
      "AllowCredentials": true,
      "PreflightMaxAge": 86400
    },
    "DownstreamServices": {
      "Identity": {
        "BaseUrl": "https://localhost:5011",
        "HealthEndpoint": "/health",
        "TimeoutSeconds": 30,
        "RetryCount": 3,
        "EnableCircuitBreaker": true,
        "FailureThreshold": 0.5,
        "CircuitBreakerTimeoutSeconds": 60
      },
      "User": {
        "BaseUrl": "https://localhost:5021",
        "HealthEndpoint": "/health",
        "TimeoutSeconds": 30,
        "RetryCount": 3,
        "EnableCircuitBreaker": true,
        "FailureThreshold": 0.5,
        "CircuitBreakerTimeoutSeconds": 60
      },
      "Notification": {
        "BaseUrl": "https://localhost:5003",
        "HealthEndpoint": "/health",
        "TimeoutSeconds": 25,
        "RetryCount": 2,
        "EnableCircuitBreaker": true,
        "FailureThreshold": 0.3,
        "CircuitBreakerTimeoutSeconds": 45
      }
    }
  }
}